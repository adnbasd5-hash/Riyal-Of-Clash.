<script>
const canvas=document.getElementById("mainCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

/* ================= STATE ================= */
let state="menu";
let selectedHero=0;
let screenShake=0;
let score=0;
let gasRadius;

/* ================= HERO TYPES ================= */
const heroes=[
{ name:"Fighter", hp:5000, speed:3.2, damage:900, color:"cyan" },
{ name:"Sniper", hp:3200, speed:3.8, damage:1500, color:"orange" },
{ name:"Tank", hp:8000, speed:2.5, damage:700, color:"lime" }
];

let player;
let enemies=[];
let bullets=[];
let cubes=[];
let particles=[];
let texts=[];

/* ================= INIT ================= */
function startGame(){
let h=heroes[selectedHero];
player={
x:canvas.width/2,
y:canvas.height/2,
hp:h.hp,
maxHp:h.hp,
speed:h.speed,
damage:h.damage,
color:h.color,
ammo:3,
maxAmmo:3,
reload:800,
lastShot:0,
super:0,
size:42,
power:1,
dashCooldown:0
};
enemies=[];
score=0;
gasRadius=Math.max(canvas.width,canvas.height);
state="playing";
}

/* ================= CONTROLS ================= */
let keys={};
window.addEventListener("keydown",e=>{
keys[e.key]=true;

if(state==="menu"){
if(e.key==="1") selectedHero=0;
if(e.key==="2") selectedHero=1;
if(e.key==="3") selectedHero=2;
if(e.key==="Enter") startGame();
}
});
window.addEventListener("keyup",e=>keys[e.key]=false);
window.addEventListener("click",()=>{
if(state==="gameover"||state==="win") state="menu";
});

/* ================= LOOP ================= */
function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);

if(screenShake>0){
ctx.translate((Math.random()-0.5)*10,(Math.random()-0.5)*10);
screenShake--;
}

if(state==="menu") drawMenu();
if(state==="playing") updateGame();
if(state==="gameover") drawCenter("ðŸ’€ Ø®Ø³Ø±Øª - Ø§Ø¶ØºØ· Ù„Ù„Ø¹ÙˆØ¯Ø©");
if(state==="win") drawCenter("ðŸ”¥ ÙØ²Øª - Ø§Ø¶ØºØ· Ù„Ù„Ø¹ÙˆØ¯Ø©");

ctx.setTransform(1,0,0,1,0,0);
requestAnimationFrame(loop);
}

/* ================= MENU ================= */
function drawMenu(){
ctx.fillStyle="white";
ctx.font="30px Arial";
ctx.fillText("Ø§Ø®ØªØ± Ø¨Ø·Ù„Ùƒ:",canvas.width/2-80,150);
ctx.fillText("1-Fighter",canvas.width/2-80,200);
ctx.fillText("2-Sniper",canvas.width/2-80,240);
ctx.fillText("3-Tank",canvas.width/2-80,280);
ctx.fillText("Enter Ù„Ù„Ø¨Ø¯Ø¡",canvas.width/2-80,330);
}

/* ================= GAME ================= */
function updateGame(){
spawnEnemies();
movePlayer();
updateBullets();
updateEnemies();
updateCubes();
updateParticles();
updateTexts();
updateGas();
drawUI();

if(enemies.length===0&&score>8) state="win";
}

/* ================= PLAYER ================= */
function movePlayer(){
let dx=0,dy=0;
if(keys["w"]) dy=-1;
if(keys["s"]) dy=1;
if(keys["a"]) dx=-1;
if(keys["d"]) dx=1;

let len=Math.hypot(dx,dy);
if(len>0){dx/=len;dy/=len;}

player.x+=dx*player.speed;
player.y+=dy*player.speed;

if(keys[" "] && Date.now()-player.lastShot>player.reload && player.ammo>0){
shoot(dx||1,dy);
player.ammo--;
player.lastShot=Date.now();
}

if(keys["Shift"] && player.dashCooldown<=0){
player.x+=dx*80;
player.y+=dy*80;
player.dashCooldown=100;
}

if(player.dashCooldown>0) player.dashCooldown--;

ctx.fillStyle=player.color;
ctx.beginPath();
ctx.arc(player.x,player.y,player.size/2,0,Math.PI*2);
ctx.fill();

if(player.hp<=0) state="gameover";
}

/* ================= SHOOT ================= */
function shoot(dx,dy){
bullets.push({
x:player.x,
y:player.y,
vx:dx*12,
vy:dy*12,
damage:player.damage*player.power
});
}

/* ================= ENEMIES ================= */
function spawnEnemies(){
if(enemies.length<6 && Math.random()<0.02){
enemies.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
hp:3000,
size:40
});
}
}

function updateEnemies(){
enemies.forEach((e,i)=>{
let dist=Math.hypot(player.x-e.x,player.y-e.y);

if(e.hp<1000){
e.x-=(player.x-e.x)*0.02; // ÙŠÙ‡Ø±Ø¨
e.y-=(player.y-e.y)*0.02;
}else{
e.x+=(player.x-e.x)*0.01;
e.y+=(player.y-e.y)*0.01;
}

ctx.fillStyle="red";
ctx.beginPath();
ctx.arc(e.x,e.y,e.size/2,0,Math.PI*2);
ctx.fill();

if(dist<40){
player.hp-=5;
}

bullets.forEach((b,bi)=>{
if(Math.hypot(b.x-e.x,b.y-e.y)<30){
e.hp-=b.damage;
texts.push({x:e.x,y:e.y,t:b.damage,life:30});
spawnParticles(e.x,e.y);
screenShake=5;
bullets.splice(bi,1);
if(e.hp<=0){
cubes.push({x:e.x,y:e.y});
enemies.splice(i,1);
score++;
}
}
});
});
}

/* ================= BULLETS ================= */
function updateBullets(){
bullets.forEach(b=>{
b.x+=b.vx;
b.y+=b.vy;
ctx.fillStyle="yellow";
ctx.beginPath();
ctx.arc(b.x,b.y,6,0,Math.PI*2);
ctx.fill();
});
}

/* ================= GAS ================= */
function updateGas(){
gasRadius-=0.04;
ctx.beginPath();
ctx.arc(canvas.width/2,canvas.height/2,gasRadius,0,Math.PI*2);
ctx.strokeStyle="rgba(0,255,0,0.4)";
ctx.lineWidth=40;
ctx.stroke();

if(Math.hypot(player.x-canvas.width/2,player.y-canvas.height/2)>gasRadius){
player.hp-=3;
}
}

/* ================= POWER ================= */
function updateCubes(){
cubes.forEach((c,i)=>{
ctx.fillStyle="lime";
ctx.fillRect(c.x-8,c.y-8,16,16);
if(Math.hypot(player.x-c.x,player.y-c.y)<30){
player.power+=0.2;
player.maxHp+=200;
player.hp+=200;
cubes.splice(i,1);
}
});
}

/* ================= FX ================= */
function spawnParticles(x,y){
for(let i=0;i<8;i++){
particles.push({x,y,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:20});
}
}

function updateParticles(){
particles.forEach((p,i)=>{
p.x+=p.vx;p.y+=p.vy;p.life--;
ctx.fillStyle="orange";
ctx.fillRect(p.x,p.y,3,3);
if(p.life<=0) particles.splice(i,1);
});
}

function updateTexts(){
texts.forEach((t,i)=>{
ctx.fillStyle="white";
ctx.fillText(t.t,t.x,t.y);
t.y-=1;t.life--;
if(t.life<=0) texts.splice(i,1);
});
}

/* ================= UI ================= */
function drawUI(){
ctx.fillStyle="white";
ctx.fillText("HP:"+Math.floor(player.hp),20,30);
ctx.fillText("Kills:"+score,20,50);
ctx.fillText("Power:"+player.power.toFixed(1),20,70);
ctx.fillText("WASD Ø­Ø±ÙƒØ© | Space Ø§Ø·Ù„Ø§Ù‚ | Shift Ø¯Ø§Ø´",20,100);
}

function drawCenter(t){
ctx.fillStyle="white";
ctx.font="30px Arial";
ctx.fillText(t,canvas.width/2-150,canvas.height/2);
}

loop();
    </script>
